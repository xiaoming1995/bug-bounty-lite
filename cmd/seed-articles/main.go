package main

import (
	"flag"
	"fmt"
	"log"
	"math/rand"
	"time"

	"bug-bounty-lite/internal/domain"
	"bug-bounty-lite/pkg/config"
	"bug-bounty-lite/pkg/database"

	"gorm.io/gorm"
)

// é¢œè‰²å®šä¹‰
const (
	colorReset  = "\033[0m"
	colorRed    = "\033[31m"
	colorGreen  = "\033[32m"
	colorYellow = "\033[33m"
	colorCyan   = "\033[36m"
	colorBold   = "\033[1m"
)

var db *gorm.DB

// æµ‹è¯•æ–‡ç« æ•°æ®
var testArticles = []struct {
	Title       string
	Description string
	Content     string
	Category    string
	IsFeatured  bool
}{
	{
		Title:       "Webå®‰å…¨å…¥é—¨ï¼šSQLæ³¨å…¥æ”»å‡»åŸç†ä¸é˜²æŠ¤",
		Description: "æœ¬æ–‡è¯¦ç»†ä»‹ç»SQLæ³¨å…¥çš„åŸºæœ¬åŸç†ã€å¸¸è§æ”»å‡»æ‰‹æ³•ä»¥åŠæœ‰æ•ˆçš„é˜²æŠ¤æªæ–½ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºæ›´å®‰å…¨çš„Webåº”ç”¨ã€‚",
		Content: `## ä»€ä¹ˆæ˜¯SQLæ³¨å…¥ï¼Ÿ

SQLæ³¨å…¥ï¼ˆSQL Injectionï¼‰æ˜¯ä¸€ç§å¸¸è§çš„Webå®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…é€šè¿‡åœ¨ç”¨æˆ·è¾“å…¥ä¸­æ’å…¥æ¶æ„SQLä»£ç ï¼Œä»è€Œæ“çºµåç«¯æ•°æ®åº“æ‰§è¡Œéé¢„æœŸçš„æ“ä½œã€‚

## æ”»å‡»åŸç†

å½“åº”ç”¨ç¨‹åºç›´æ¥å°†ç”¨æˆ·è¾“å…¥æ‹¼æ¥åˆ°SQLæŸ¥è¯¢è¯­å¥ä¸­ï¼Œè€Œæ²¡æœ‰è¿›è¡Œé€‚å½“çš„è¿‡æ»¤æˆ–è½¬ä¹‰æ—¶ï¼Œå°±å¯èƒ½äº§ç”ŸSQLæ³¨å…¥æ¼æ´ã€‚

## å¸¸è§æ”»å‡»ç±»å‹

### 1. è”åˆæŸ¥è¯¢æ³¨å…¥ï¼ˆUnion-basedï¼‰
é€šè¿‡UNIONè¯­å¥å°†æ¶æ„æŸ¥è¯¢ç»“æœåˆå¹¶åˆ°æ­£å¸¸æŸ¥è¯¢ç»“æœä¸­ã€‚

### 2. æŠ¥é”™æ³¨å…¥ï¼ˆError-basedï¼‰
åˆ©ç”¨æ•°æ®åº“çš„æŠ¥é”™ä¿¡æ¯æ¥è·å–æ•æ„Ÿæ•°æ®ã€‚

### 3. ç›²æ³¨ï¼ˆBlind SQL Injectionï¼‰
å½“é¡µé¢ä¸æ˜¾ç¤ºæŸ¥è¯¢ç»“æœæˆ–é”™è¯¯ä¿¡æ¯æ—¶ï¼Œé€šè¿‡æ¡ä»¶åˆ¤æ–­æ¥é€æ­¥æ¨æ–­æ•°æ®ã€‚

## é˜²æŠ¤æªæ–½

### 1. å‚æ•°åŒ–æŸ¥è¯¢
ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼ˆPrepared Statementsï¼‰æ˜¯æœ€æœ‰æ•ˆçš„é˜²æŠ¤æ–¹æ³•ã€‚

### 2. è¾“å…¥éªŒè¯
å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„ç±»å‹å’Œæ ¼å¼éªŒè¯ã€‚

### 3. æœ€å°æƒé™åŸåˆ™
æ•°æ®åº“è´¦æˆ·åº”åªæ‹¥æœ‰å¿…è¦çš„æœ€å°æƒé™ã€‚`,
		Category:   "Webå®‰å…¨",
		IsFeatured: true,
	},
	{
		Title:       "XSSè·¨ç«™è„šæœ¬æ”»å‡»å…¨è§£æ",
		Description: "æ·±å…¥æµ…å‡ºè®²è§£åå°„å‹ã€å­˜å‚¨å‹ã€DOMå‹XSSçš„åŒºåˆ«ä¸åˆ©ç”¨æ–¹å¼ï¼Œä»¥åŠCSPç­‰ç°ä»£é˜²æŠ¤æŠ€æœ¯ã€‚",
		Content: `## XSSæ”»å‡»ç®€ä»‹

è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross-Site Scriptingï¼ŒXSSï¼‰æ˜¯ä¸€ç§ä»£ç æ³¨å…¥æ”»å‡»ã€‚æ”»å‡»è€…é€šè¿‡åœ¨ç½‘é¡µä¸­æ³¨å…¥æ¶æ„è„šæœ¬ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥ç½‘é¡µæ—¶ï¼Œè„šæœ¬å°±ä¼šåœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­æ‰§è¡Œã€‚

## XSSçš„ä¸‰ç§ç±»å‹

### åå°„å‹XSS
æ¶æ„è„šæœ¬é€šè¿‡URLå‚æ•°ä¼ é€’ï¼ŒæœåŠ¡å™¨å°†å…¶"åå°„"å›å“åº”é¡µé¢ã€‚

### å­˜å‚¨å‹XSS
æ¶æ„è„šæœ¬è¢«å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼ˆå¦‚æ•°æ®åº“ï¼‰ï¼Œæ¯æ¬¡ç”¨æˆ·è®¿é—®ç›¸å…³é¡µé¢æ—¶éƒ½ä¼šæ‰§è¡Œã€‚

### DOMå‹XSS
æ¶æ„è„šæœ¬é€šè¿‡ä¿®æ”¹DOMç»“æ„æ¥æ‰§è¡Œï¼Œå®Œå…¨åœ¨å®¢æˆ·ç«¯å®Œæˆã€‚

## é˜²æŠ¤ç­–ç•¥

- è¾“å‡ºç¼–ç ï¼ˆOutput Encodingï¼‰
- å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰
- HttpOnly Cookie
- è¾“å…¥éªŒè¯ä¸è¿‡æ»¤`,
		Category:   "Webå®‰å…¨",
		IsFeatured: false,
	},
	{
		Title:       "Burp Suiteå®æˆ˜æŠ€å·§åˆ†äº«",
		Description: "ä»å®‰è£…é…ç½®åˆ°é«˜çº§ç”¨æ³•ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ ä½¿ç”¨Webå®‰å…¨æµ‹è¯•ç¥å™¨Burp Suiteè¿›è¡Œæ¸—é€æµ‹è¯•ã€‚",
		Content: `## Burp Suiteç®€ä»‹

Burp Suiteæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„Webåº”ç”¨ç¨‹åºå®‰å…¨æµ‹è¯•å·¥å…·ï¼Œè¢«å¹¿æ³›ç”¨äºæ¸—é€æµ‹è¯•å’Œå®‰å…¨è¯„ä¼°ã€‚

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### Proxyï¼ˆä»£ç†ï¼‰
æ‹¦æˆªã€æŸ¥çœ‹å’Œä¿®æ”¹æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„HTTP/HTTPSæµé‡ã€‚

### Spiderï¼ˆçˆ¬è™«ï¼‰
è‡ªåŠ¨çˆ¬å–Webåº”ç”¨ç¨‹åºï¼Œå‘ç°å†…å®¹å’ŒåŠŸèƒ½ã€‚

### Scannerï¼ˆæ‰«æå™¨ï¼‰
è‡ªåŠ¨æ‰«æWebåº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨æ¼æ´ã€‚

### Intruderï¼ˆå…¥ä¾µè€…ï¼‰
å¯¹HTTPè¯·æ±‚è¿›è¡Œè‡ªåŠ¨åŒ–çš„è‡ªå®šä¹‰æ”»å‡»ã€‚

### Repeaterï¼ˆé‡å‘å™¨ï¼‰
æ‰‹åŠ¨ä¿®æ”¹å’Œé‡å‘è¯·æ±‚ï¼Œåˆ†æå“åº”ã€‚

## å®æˆ˜æŠ€å·§

1. ä½¿ç”¨Scopeé™åˆ¶æµ‹è¯•èŒƒå›´
2. åˆç†é…ç½®è¿‡æ»¤è§„åˆ™
3. å–„ç”¨Extensionsæ‰©å±•åŠŸèƒ½
4. å­¦ä¹ ä½¿ç”¨Macroså¤„ç†å¤æ‚æµç¨‹`,
		Category:   "å·¥å…·æ•™ç¨‹",
		IsFeatured: true,
	},
	{
		Title:       "ä¼ä¸šå®‰å…¨ä½“ç³»å»ºè®¾æŒ‡å—",
		Description: "ç»“åˆå®é™…æ¡ˆä¾‹ï¼Œæ¢è®¨å¦‚ä½•ä»é›¶å¼€å§‹æ„å»ºä¼ä¸šçº§å®‰å…¨é˜²æŠ¤ä½“ç³»ï¼ŒåŒ…æ‹¬ç»„ç»‡æ¶æ„ã€æµç¨‹è§„èŒƒç­‰ã€‚",
		Content: `## ä¼ä¸šå®‰å…¨ä½“ç³»æ¦‚è¿°

ä¼ä¸šå®‰å…¨ä½“ç³»æ˜¯ä¸€å¥—å®Œæ•´çš„å®‰å…¨ç®¡ç†æ¡†æ¶ï¼ŒåŒ…æ‹¬äººå‘˜ã€æŠ€æœ¯ã€æµç¨‹ä¸‰å¤§æ”¯æŸ±ã€‚

## å»ºè®¾æ­¥éª¤

### 1. å®‰å…¨ç»„ç»‡æ¶æ„
- è®¾ç«‹å®‰å…¨å§”å‘˜ä¼š
- æ˜ç¡®å®‰å…¨èŒè´£
- å»ºç«‹æ±‡æŠ¥æœºåˆ¶

### 2. å®‰å…¨åˆ¶åº¦å»ºè®¾
- å®‰å…¨æ”¿ç­–åˆ¶å®š
- æ“ä½œè§„èŒƒç¼–å†™
- åº”æ€¥é¢„æ¡ˆå‡†å¤‡

### 3. æŠ€æœ¯é˜²æŠ¤ä½“ç³»
- è¾¹ç•Œå®‰å…¨
- ç»ˆç«¯å®‰å…¨
- æ•°æ®å®‰å…¨

### 4. å®‰å…¨è¿è¥
- æ—¥å¸¸ç›‘æ§
- äº‹ä»¶å“åº”
- æŒç»­æ”¹è¿›

## æœ€ä½³å®è·µ

- ä»ä¸šåŠ¡è§’åº¦å‡ºå‘
- é£é™©é©±åŠ¨çš„å®‰å…¨æŠ•å…¥
- å®‰å…¨æ„è¯†åŸ¹è®­
- å®šæœŸå®‰å…¨æ¼”ç»ƒ`,
		Category:   "å®‰å…¨ç®¡ç†",
		IsFeatured: false,
	},
	{
		Title:       "CTFå…¥é—¨ï¼šä»é›¶å¼€å§‹çš„å¤ºæ——ä¹‹æ—…",
		Description: "ä¸ºCTFæ–°æ‰‹å‡†å¤‡çš„å…¥é—¨æŒ‡å—ï¼Œæ¶µç›–Webã€Cryptoã€Pwnç­‰æ–¹å‘çš„åŸºç¡€çŸ¥è¯†å’Œç»ƒä¹ å¹³å°æ¨èã€‚",
		Content: `## ä»€ä¹ˆæ˜¯CTFï¼Ÿ

CTFï¼ˆCapture The Flagï¼‰æ˜¯ç½‘ç»œå®‰å…¨é¢†åŸŸçš„ä¸€ç§ç«èµ›å½¢å¼ï¼Œå‚èµ›è€…é€šè¿‡è§£å†³å„ç±»å®‰å…¨æŒ‘æˆ˜æ¥è·å–Flagã€‚

## CTFä¸»è¦æ–¹å‘

### Webå®‰å…¨
- SQLæ³¨å…¥ã€XSSã€CSRF
- æ–‡ä»¶ä¸Šä¼ æ¼æ´
- ä»£ç å®¡è®¡

### Cryptoï¼ˆå¯†ç å­¦ï¼‰
- å¤å…¸å¯†ç 
- ç°ä»£åŠ å¯†ç®—æ³•
- å¯†ç åˆ†æ

### Pwnï¼ˆäºŒè¿›åˆ¶æ¼æ´ï¼‰
- æ ˆæº¢å‡º
- å †åˆ©ç”¨
- ROPé“¾

### Reverseï¼ˆé€†å‘å·¥ç¨‹ï¼‰
- é™æ€åˆ†æ
- åŠ¨æ€è°ƒè¯•
- åæ··æ·†

### Miscï¼ˆæ‚é¡¹ï¼‰
- éšå†™æœ¯
- å–è¯åˆ†æ

## å…¥é—¨å»ºè®®

1. é€‰æ‹©1-2ä¸ªæ–¹å‘æ·±å…¥å­¦ä¹ 
2. å¤šåšç»ƒä¹ é¢˜ç›®
3. å‚åŠ çº¿ä¸Šæ¯”èµ›
4. åŠ å…¥CTFæˆ˜é˜Ÿ

## æ¨èå¹³å°

- CTFHub
- BugKu
- æ”»é˜²ä¸–ç•Œ`,
		Category:   "CTF",
		IsFeatured: true,
	},
	{
		Title:       "æ¸—é€æµ‹è¯•æ–¹æ³•è®ºä¸æµç¨‹",
		Description: "ç³»ç»Ÿä»‹ç»æ¸—é€æµ‹è¯•çš„æ ‡å‡†æµç¨‹ï¼Œä»ä¿¡æ¯æ”¶é›†åˆ°æŠ¥å‘Šç¼–å†™çš„å®Œæ•´æŒ‡å—ã€‚",
		Content: `## æ¸—é€æµ‹è¯•æµç¨‹

### 1. å‰æœŸäº¤äº’
- ç¡®å®šæµ‹è¯•èŒƒå›´
- ç­¾ç½²æˆæƒåè®®
- äº†è§£ä¸šåŠ¡èƒŒæ™¯

### 2. ä¿¡æ¯æ”¶é›†
- è¢«åŠ¨ä¿¡æ¯æ”¶é›†
- ä¸»åŠ¨ä¿¡æ¯æ”¶é›†
- ç¤¾ä¼šå·¥ç¨‹å­¦

### 3. å¨èƒå»ºæ¨¡
- è¯†åˆ«èµ„äº§
- åˆ†æå¨èƒ
- ç¡®å®šä¼˜å…ˆçº§

### 4. æ¼æ´åˆ†æ
- è‡ªåŠ¨åŒ–æ‰«æ
- æ‰‹å·¥éªŒè¯
- æ¼æ´è¯„ä¼°

### 5. æ¼æ´åˆ©ç”¨
- è·å–è®¿é—®æƒé™
- æƒé™æå‡
- æ¨ªå‘ç§»åŠ¨

### 6. åæ¸—é€
- æŒä¹…åŒ–è®¿é—®
- æ•°æ®æ”¶é›†
- ç—•è¿¹æ¸…ç†

### 7. æŠ¥å‘Šç¼–å†™
- æ‰§è¡Œæ‘˜è¦
- è¯¦ç»†å‘ç°
- ä¿®å¤å»ºè®®`,
		Category:   "æ¸—é€æµ‹è¯•",
		IsFeatured: false,
	},
	{
		Title:       "OWASP Top 10 æ¼æ´è¯¦è§£",
		Description: "æ·±å…¥è§£æOWASPæœ€æ–°å‘å¸ƒçš„åå¤§Webåº”ç”¨å®‰å…¨é£é™©ï¼Œäº†è§£æ¯ç§æ¼æ´çš„åŸç†å’Œé˜²æŠ¤æ–¹æ³•ã€‚",
		Content: `## OWASP Top 10 2021

### A01:2021 - è®¿é—®æ§åˆ¶å¤±æ•ˆ
æƒé™æ§åˆ¶ä¸å½“å¯¼è‡´æœªæˆæƒè®¿é—®ã€‚

### A02:2021 - åŠ å¯†å¤±è´¥
æ•æ„Ÿæ•°æ®æœªæ­£ç¡®åŠ å¯†ä¿æŠ¤ã€‚

### A03:2021 - æ³¨å…¥
SQLã€NoSQLã€OSå‘½ä»¤ç­‰æ³¨å…¥æ”»å‡»ã€‚

### A04:2021 - ä¸å®‰å…¨è®¾è®¡
è®¾è®¡é˜¶æ®µçš„å®‰å…¨ç¼ºé™·ã€‚

### A05:2021 - å®‰å…¨é…ç½®é”™è¯¯
é»˜è®¤é…ç½®ã€ä¸å¿…è¦åŠŸèƒ½å¼€å¯ç­‰ã€‚

### A06:2021 - æ˜“å—æ”»å‡»å’Œè¿‡æ—¶çš„ç»„ä»¶
ä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶ã€‚

### A07:2021 - èº«ä»½è®¤è¯å¤±è´¥
ä¼šè¯ç®¡ç†å’Œè®¤è¯æœºåˆ¶ç¼ºé™·ã€‚

### A08:2021 - è½¯ä»¶å’Œæ•°æ®å®Œæ•´æ€§å¤±è´¥
æœªéªŒè¯æ›´æ–°ã€CI/CDç®¡é“å®‰å…¨ã€‚

### A09:2021 - å®‰å…¨æ—¥å¿—è®°å½•å’Œç›‘æ§å¤±è´¥
ç¼ºä¹æœ‰æ•ˆçš„æ—¥å¿—å’Œå‘Šè­¦æœºåˆ¶ã€‚

### A10:2021 - æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ (SSRF)
è¯±å¯¼æœåŠ¡ç«¯å‘èµ·æ¶æ„è¯·æ±‚ã€‚`,
		Category:   "Webå®‰å…¨",
		IsFeatured: false,
	},
	{
		Title:       "ç§»åŠ¨åº”ç”¨å®‰å…¨æµ‹è¯•æŒ‡å—",
		Description: "é’ˆå¯¹Androidå’ŒiOSåº”ç”¨çš„å®‰å…¨æµ‹è¯•æ–¹æ³•ï¼ŒåŒ…æ‹¬é™æ€åˆ†æã€åŠ¨æ€åˆ†æå’Œé€†å‘å·¥ç¨‹æŠ€æœ¯ã€‚",
		Content: `## ç§»åŠ¨å®‰å…¨æµ‹è¯•æ¦‚è¿°

ç§»åŠ¨åº”ç”¨å®‰å…¨æµ‹è¯•éœ€è¦ç»“åˆé™æ€åˆ†æå’ŒåŠ¨æ€åˆ†æä¸¤ç§æ–¹æ³•ã€‚

## Androidå®‰å…¨æµ‹è¯•

### é™æ€åˆ†æ
- APKåç¼–è¯‘
- ä»£ç å®¡è®¡
- é…ç½®æ£€æŸ¥

### åŠ¨æ€åˆ†æ
- æŠ“åŒ…åˆ†æ
- Frida Hook
- è¿è¡Œæ—¶ç›‘æ§

### å¸¸è§æ¼æ´
- ä¸å®‰å…¨çš„æ•°æ®å­˜å‚¨
- å¼±åŠ å¯†å®ç°
- ç»„ä»¶æš´éœ²

## iOSå®‰å…¨æµ‹è¯•

### é™æ€åˆ†æ
- IPAè§£åŒ…
- äºŒè¿›åˆ¶åˆ†æ
- Info.plistæ£€æŸ¥

### åŠ¨æ€åˆ†æ
- è¶Šç‹±è®¾å¤‡æµ‹è¯•
- Cycriptè°ƒè¯•
- SSL Pinningç»‘å®š

## æµ‹è¯•å·¥å…·

- MobSF
- Drozer
- Objection
- Frida`,
		Category:   "ç§»åŠ¨å®‰å…¨",
		IsFeatured: false,
	},
	{
		Title:       "äº‘å®‰å…¨æœ€ä½³å®è·µ",
		Description: "æ¢è®¨AWSã€Azureã€GCPç­‰ä¸»æµäº‘å¹³å°çš„å®‰å…¨é…ç½®å’Œæœ€ä½³å®è·µï¼Œä¿æŠ¤äº‘ä¸Šèµ„äº§å®‰å…¨ã€‚",
		Content: `## äº‘å®‰å…¨æŒ‘æˆ˜

äº‘ç¯å¢ƒå¸¦æ¥äº†æ–°çš„å®‰å…¨æŒ‘æˆ˜ï¼š
- è´£ä»»å…±æ‹…æ¨¡å‹
- å¤šç§Ÿæˆ·é£é™©
- é…ç½®å¤æ‚æ€§

## èº«ä»½å’Œè®¿é—®ç®¡ç†(IAM)

### æœ€ä½³å®è·µ
- æœ€å°æƒé™åŸåˆ™
- MFAå¤šå› ç´ è®¤è¯
- å®šæœŸå®¡è®¡æƒé™
- ä½¿ç”¨è§’è‰²è€Œéé•¿æœŸå‡­è¯

## ç½‘ç»œå®‰å…¨

- VPCéš”ç¦»
- å®‰å…¨ç»„é…ç½®
- ç§æœ‰å­ç½‘
- VPN/ä¸“çº¿

## æ•°æ®ä¿æŠ¤

- é™æ€åŠ å¯†
- ä¼ è¾“åŠ å¯†
- å¯†é’¥ç®¡ç†
- å¤‡ä»½ç­–ç•¥

## ç›‘æ§ä¸å®¡è®¡

- äº‘å®¡è®¡æ—¥å¿—
- å¼‚å¸¸æ£€æµ‹
- å‘Šè­¦é…ç½®
- åˆè§„æŠ¥å‘Š

## å®‰å…¨å·¥å…·

- AWS Security Hub
- Azure Security Center
- GCP Security Command Center`,
		Category:   "äº‘å®‰å…¨",
		IsFeatured: true,
	},
	{
		Title:       "ä»£ç å®¡è®¡å®æˆ˜æŠ€å·§",
		Description: "åˆ†äº«ä»£ç å®¡è®¡çš„æ–¹æ³•è®ºå’Œå®æˆ˜ç»éªŒï¼Œå¿«é€Ÿå®šä½Webåº”ç”¨ä¸­çš„å®‰å…¨æ¼æ´ã€‚",
		Content: `## ä»£ç å®¡è®¡æ–¹æ³•

### é€šè¯»æ³•
ä»å…¥å£ç‚¹å¼€å§‹ï¼Œè·Ÿè¸ªæ•°æ®æµå‘ã€‚

### å±é™©å‡½æ•°æ³•
æœç´¢å±é™©å‡½æ•°ï¼Œå›æº¯å‚æ•°æ¥æºã€‚

### åŠŸèƒ½ç‚¹å®¡è®¡
é’ˆå¯¹ç‰¹å®šåŠŸèƒ½è¿›è¡Œå®‰å…¨åˆ†æã€‚

## PHPå¸¸è§æ¼æ´

- å˜é‡è¦†ç›–
- æ–‡ä»¶åŒ…å«
- ååºåˆ—åŒ–
- å‘½ä»¤æ‰§è¡Œ

## Javaå¸¸è§æ¼æ´

- è¡¨è¾¾å¼æ³¨å…¥
- XXEæ¼æ´
- ååºåˆ—åŒ–
- SSRF

## å®¡è®¡æŠ€å·§

1. ç†è§£ä¸šåŠ¡é€»è¾‘
2. å…³æ³¨æ•°æ®æµå‘
3. æ£€æŸ¥è¾“å…¥éªŒè¯
4. å®¡æŸ¥æƒé™æ§åˆ¶
5. åˆ†æç¬¬ä¸‰æ–¹ç»„ä»¶

## å®¡è®¡å·¥å…·

- RIPS
- Fortify
- Checkmarx
- SemGrep`,
		Category:   "ä»£ç å®‰å…¨",
		IsFeatured: false,
	},
}

func main() {
	// å‘½ä»¤è¡Œå‚æ•°
	count := flag.Int("count", 0, "ç”ŸæˆæŒ‡å®šæ•°é‡çš„æ–‡ç« ï¼ˆ0è¡¨ç¤ºä½¿ç”¨æ‰€æœ‰é¢„è®¾æ–‡ç« ï¼‰")
	clean := flag.Bool("clean", false, "æ¸…é™¤æ‰€æœ‰æµ‹è¯•æ–‡ç« åé‡æ–°ç”Ÿæˆ")
	flag.Parse()

	// åŠ è½½é…ç½®
	cfg := config.LoadConfig()

	// è¿æ¥æ•°æ®åº“
	db = database.InitDB(cfg)

	printBanner()

	// ä½œè€…IDé»˜è®¤ä¸º0ï¼Œæ˜¾ç¤ºä¸º"ç®¡ç†å‘˜"
	authorID := uint(0)
	fmt.Printf("%s[INFO]%s ä½œè€…ID: %d (æ˜¾ç¤ºä¸º: ç®¡ç†å‘˜)%s\n", colorCyan, colorReset, authorID, colorReset)

	// æ¸…é™¤æ—§æ•°æ®
	if *clean {
		cleanArticles()
	}

	// ç”Ÿæˆæ–‡ç« 
	generateArticles(authorID, *count)
}

func printBanner() {
	fmt.Println()
	fmt.Printf("%s%sâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—%s\n", colorBold, colorCyan, colorReset)
	fmt.Printf("%s%sâ•‘  ğŸ“ å­¦ä¹ ä¸­å¿ƒæ–‡ç« æ•°æ®ç”Ÿæˆå·¥å…·           â•‘%s\n", colorBold, colorCyan, colorReset)
	fmt.Printf("%s%sâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•%s\n", colorBold, colorCyan, colorReset)
	fmt.Println()
}

func cleanArticles() {
	fmt.Printf("%s[INFO]%s æ­£åœ¨æ¸…é™¤ç°æœ‰æ–‡ç« æ•°æ®...%s\n", colorYellow, colorReset, colorReset)

	// æ¸…é™¤è¯„è®º
	if err := db.Exec("DELETE FROM article_comments").Error; err != nil {
		log.Printf("%s[WARN]%s æ¸…é™¤è¯„è®ºå¤±è´¥: %v%s\n", colorYellow, colorReset, err, colorReset)
	}

	// æ¸…é™¤ç‚¹èµ
	if err := db.Exec("DELETE FROM article_likes").Error; err != nil {
		log.Printf("%s[WARN]%s æ¸…é™¤ç‚¹èµå¤±è´¥: %v%s\n", colorYellow, colorReset, err, colorReset)
	}

	// æ¸…é™¤æµè§ˆè®°å½•
	if err := db.Exec("DELETE FROM article_views").Error; err != nil {
		log.Printf("%s[WARN]%s æ¸…é™¤æµè§ˆè®°å½•å¤±è´¥: %v%s\n", colorYellow, colorReset, err, colorReset)
	}

	// æ¸…é™¤æ–‡ç« 
	if err := db.Exec("DELETE FROM articles").Error; err != nil {
		log.Printf("%s[ERROR]%s æ¸…é™¤æ–‡ç« å¤±è´¥: %v%s\n", colorRed, colorReset, err, colorReset)
		return
	}

	fmt.Printf("%s[OK]%s å·²æ¸…é™¤æ‰€æœ‰æ–‡ç« æ•°æ®%s\n", colorGreen, colorReset, colorReset)
}

func generateArticles(authorID uint, count int) {
	rand.Seed(time.Now().UnixNano())

	articles := testArticles
	if count > 0 && count < len(testArticles) {
		articles = testArticles[:count]
	}

	fmt.Printf("\n%s[INFO]%s å¼€å§‹ç”Ÿæˆ %d ç¯‡æµ‹è¯•æ–‡ç« ...%s\n\n", colorCyan, colorReset, len(articles), colorReset)

	successCount := 0
	for i, a := range articles {
		article := &domain.Article{
			Title:       a.Title,
			Description: a.Description,
			Content:     a.Content,
			Category:    a.Category,
			AuthorID:    authorID,
			Status:      "approved", // ç›´æ¥è®¾ä¸ºå·²å‘å¸ƒ
			IsFeatured:  a.IsFeatured,
			Views:       rand.Intn(5000) + 100, // éšæœºæµè§ˆé‡
			Likes:       rand.Intn(100),        // éšæœºç‚¹èµæ•°
		}

		if err := db.Create(article).Error; err != nil {
			fmt.Printf("  %s[%d]%s âŒ %s - %v%s\n", colorRed, i+1, colorReset, a.Title, err, colorReset)
			continue
		}

		featured := ""
		if a.IsFeatured {
			featured = " â­ç²¾é€‰"
		}
		fmt.Printf("  %s[%d]%s âœ… %s [%s]%s%s\n", colorGreen, i+1, colorReset, a.Title, a.Category, featured, colorReset)
		successCount++
	}

	fmt.Println()
	fmt.Printf("%sâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•%s\n", colorCyan, colorReset)
	fmt.Printf("%s[å®Œæˆ]%s æˆåŠŸç”Ÿæˆ %d/%d ç¯‡æ–‡ç« %s\n", colorGreen, colorReset, successCount, len(articles), colorReset)
	fmt.Println()
}
